# Скрипты сборки и тестирования

## Структура

```
scripts/
├── docker.sh       # Основной скрипт сборки
├── docker.test.sh  # Скрипт тестирования
├── docker.http     # HTTP тесты для REST-клиента
└── README.md       # Эта документация
```

## Подготовка к использованию

### Установка прав доступа

Перед использованием необходимо установить права на выполнение скриптов:

```bash
# Установка прав на выполнение
chmod +x scripts/docker.sh
chmod +x scripts/docker.test.sh

# Проверка health endpoint
curl http://localhost:8000/health

# Проверка chat endpoint
curl -X POST \
  http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"test message"}'
```

## Скрипт сборки (docker.sh)

Основной скрипт для сборки и запуска сервиса в Docker.

### Использование

```bash
# Только сборка и запуск
./docker.sh

# Сборка, запуск и тестирование
./docker.sh --test

Сборка и тесты:
./scripts/docker.test.sh
```

### Функциональность

1. Безопасная очистка:
   - Удаляет только контейнеры проекта
   - Проверяет существование перед удалением
   - Не затрагивает другие проекты

2. Проверка окружения:
   - Проверяет наличие .env файла
   - Валидирует необходимые переменные окружения

3. Сборка и запуск:
   - Пеесборка с --no-cache для чистой сборки
   - Корректное именование образов и контейнеров
   - Передача переменных окружения

## Скрипт тестирования (docker.test.sh)

Отдельный скрипт для тестирования запущенного сервиса.

### Использование

```bash
# Запуск всех тестов
./docker.test.sh
```

### Тесты

1. Health Check:
   - Проверка доступности сервиса
   - Валидация ответа health endpoint
   - Мониторинг статуса контейнера

2. API Tests:
   - Тест POST /chat endpoint
   - Проверка обработки пустых сообщений
   - Валидация формата ответов

3. Интеграционные тесты:
   - Тест Groq API интеграции
   - Тест Neo API интеграции
   - Проверка WebSocket соединения

## Рекомендации по использованию

1. Разработка:
   ```bash
   ./docker.sh  # Запуск сервиса
   ./docker.test.sh  # Отдельный запуск тестов при необходимости
   ```

2. CI/CD:
   ```bash
   ./docker.sh --test  # Полный цикл сборки и тестирования
   ```

3. Отладка:
   ```bash
   # Просмотр логов
   docker logs neonchat-service -f

   # Проверка статуса
   docker ps | grep neonchat
   ```

## Переменные окружения

Необходимые переменные в .env файле:
- `GROQ_API_KEY` - ключ для Groq API
- `NEO_API_KEY` - ключ для Neo API

## Безопасность

- Скрипты работают только с контейнерами проекта
- Проверки существования перед удалением
- Безопасная обработка переменных окружения
- Изолированная сеть Docker

## Troubleshooting

1. Если скрипты не запускаются:
   ```bash
   # Проверка прав
   ls -l scripts/docker.*
   
   # Установка прав если необходимо
   chmod +x scripts/docker.sh scripts/docker.test.sh
   ```

2. Если сервис не запускается:
   ```bash
   docker logs neonchat-service
   ```

3. Если тесты падают:
   ```bash
   ./docker.test.sh  # Запуск только тестов
   ```

4. Для полной пересборки:
   ```bash
   ./docker.sh  # Автоматически выполняет clean build
   ```

## HTTP тесты

Файл `docker.http` содержит тесты для REST-клиента (например, VS Code REST Client или IntelliJ HTTP Client):

- Базовые проверки health endpoint
- Тесты chat API
- Проверки обработки ошибок
- WebSocket тесты

Для использования:
1. Установите REST Client плагин
2. Откройте docker.http
3. Используйте "Send Request" для выполнения отдельных тестов